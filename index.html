<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SecureText</title>

  <link rel="stylesheet" href="style.css" />

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

  <style>
    /* =========================
       CACHE BUST (optional)
       ========================= */
    /* (kept empty on purpose) */

    /* =========================
       ADMIN PATH BUTTON
       ========================= */
    .admin-path-btn {
      position: absolute;
      top: 15px;
      right: 20px;
      padding: 6px 14px;
      background-color: #111;
      color: white;
      border: 1px solid #333;
      font-size: 13px;
      cursor: pointer;
      transition: 0.2s;
      z-index: 50;
      border-radius: 10px;
    }
    .admin-path-btn:hover { background-color: #222; }

    /* =========================
       GLOBAL + FIX OUTER SCROLL
       ========================= */
    html, body {
      height: 100%;
      margin: 0;
    }

    body{
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(80,140,255,.12), transparent 60%),
        radial-gradient(800px 500px at 80% 20%, rgba(60,255,160,.10), transparent 55%),
        radial-gradient(900px 700px at 50% 85%, rgba(255,255,255,.06), transparent 60%),
        #070a0f;
      color: rgba(255,255,255,.92);
      overflow: hidden; /* KEY: prevents page scrollbar */
      font-family: Arial, sans-serif;
    }

    #root {
      position: relative;
      height: 100vh;
      width: 100%;
      padding: 20px;
      box-sizing: border-box;
      overflow: hidden; /* KEY: no outer scroll */
    }

    /* smooth screen transitions */
    .screen { display:none; opacity:0; transform: translateY(10px); }
    .screen.active {
      display:block;
      opacity:1;
      transform: translateY(0);
      transition: opacity .22s ease, transform .22s ease;
    }

    /* =========================
       MODERN ENTRY UI
       ========================= */
    :root{
      --glass: rgba(18,18,18,.55);
      --glass2: rgba(18,18,18,.35);
      --border: rgba(255,255,255,.08);
      --border2: rgba(255,255,255,.12);
      --text: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.65);
      --accent: rgba(68, 255, 160, .9);
      --danger: rgba(255, 90, 90, .95);
      --warn: rgba(255, 211, 107, .95);
      --shadow: 0 24px 70px rgba(0,0,0,.55);
    }

    #screen-class, #screen-pin, #screen-name, #screen-wait {
      height: 100%;
      display: grid;
      place-items: center;
      padding: 10px;
      box-sizing: border-box;
      overflow: hidden;
    }

    .entry-card{
      width: min(720px, 94vw);
      background: linear-gradient(180deg, var(--glass), var(--glass2));
      border: 1px solid var(--border);
      border-radius: 18px;
      box-shadow: var(--shadow);
      padding: 26px 24px;
      overflow: hidden;
      position: relative;
      animation: cardIn .38s ease;
      transform-origin: center;
    }

    .entry-card::before{
      content:"";
      position:absolute;
      inset:-2px;
      background: radial-gradient(500px 220px at 30% 0%, rgba(80,140,255,.22), transparent 60%),
                  radial-gradient(500px 220px at 70% 0%, rgba(60,255,160,.18), transparent 60%);
      filter: blur(10px);
      opacity: .55;
      pointer-events:none;
    }

    @keyframes cardIn{
      from{ opacity:0; transform: translateY(14px) scale(.985); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }

    .entry-top{
      position: relative;
      z-index: 1;
      display:flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }

    .brand{ display:flex; align-items:center; gap:10px; }

    .brand-badge{
      width:38px; height:38px;
      border-radius: 12px;
      background: rgba(255,255,255,.06);
      border: 1px solid var(--border);
      display:grid;
      place-items:center;
      box-shadow: 0 10px 30px rgba(0,0,0,.35);
      position: relative;
      overflow:hidden;
    }

    .brand-badge::after{
      content:"";
      position:absolute;
      inset:-30%;
      background: conic-gradient(from 180deg, rgba(60,255,160,.0), rgba(60,255,160,.25), rgba(80,140,255,.25), rgba(60,255,160,.0));
      animation: spin 3.5s linear infinite;
      opacity:.85;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    .brand-badge span{
      position: relative;
      z-index: 2;
      font-weight: 800;
      letter-spacing:.5px;
      opacity:.95;
    }

    .entry-title{
      position: relative;
      z-index: 1;
      font-size: 28px;
      margin: 0;
      line-height: 1.15;
    }
    .entry-sub{
      position: relative;
      z-index: 1;
      margin: 6px 0 0 0;
      color: var(--muted);
      font-size: 14px;
    }

    .btn{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease, background .12s ease;
    }
    .btn:hover{ transform: translateY(-1px); filter: brightness(1.05); background: rgba(255,255,255,.08); }
    .btn:active{ transform: translateY(0); opacity:.95; }

    .btn.primary{
      background: rgba(60,255,160,.14);
      border-color: rgba(60,255,160,.28);
    }
    .btn.ghost{ background: transparent; }

    .entry-form{
      position: relative;
      z-index: 1;
      margin-top: 18px;
      display:grid;
      gap: 12px;
    }
    .field{ display:grid; gap: 8px; }
    .label{ font-size: 12px; color: var(--muted); letter-spacing: .2px; }

    .input{
      width:100%;
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(0,0,0,.35);
      border: 1px solid var(--border);
      color: var(--text);
      outline: none;
      transition: border-color .12s ease, transform .12s ease, background .12s ease;
      box-sizing: border-box;
    }
    .input:focus{
      border-color: rgba(80,140,255,.35);
      background: rgba(0,0,0,.45);
      transform: translateY(-1px);
    }

    .classes-wrap{
      position: relative;
      z-index: 1;
      display:grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    .class-tile{
      border: 1px solid var(--border);
      background: rgba(255,255,255,.05);
      border-radius: 16px;
      padding: 14px 14px;
      cursor: pointer;
      transition: transform .14s ease, background .14s ease, border-color .14s ease;
      animation: tileIn .28s ease;
    }
    @keyframes tileIn{
      from{ opacity:0; transform: translateY(8px); }
      to{ opacity:1; transform: translateY(0); }
    }
    .class-tile:hover{
      transform: translateY(-2px);
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.14);
    }
    .class-name{ font-weight: 700; margin: 0; font-size: 15px; }
    .class-meta{ margin: 6px 0 0 0; font-size: 12px; color: var(--muted); }

    .notice { margin-top: 10px; }
    .notice.bad{ color: var(--danger) !important; }
    .notice.warn{ color: var(--warn) !important; }
    .notice.good{ color: var(--accent) !important; }

    @media(max-width:720px){
      .classes-wrap{ grid-template-columns: 1fr; }
    }

    /* =========================
       CLIENT CHAT SCALING FIX
       (matches your screenshot issue)
       ========================= */
    #screen-chat {
      height: 100%;
      overflow: hidden;
    }

    /* full-height chat container */
    #chat-screen{
      height: 100%;
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      overflow: hidden;    /* KEY: prevents outer scroll */
      border-radius: 14px;
    }

    /* announcements should be full width under header */
    #announcementsBox {
      flex: 0 0 auto;
      margin: 10px 12px 0 12px;
      border-radius: 12px;
      padding: 10px 12px;
      background: rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.08);
    }
    #announcementsList{
      max-height: 90px;
      overflow-y: auto;
      margin-top: 8px;
    }

    /* messages are the only scroll area */
    #messages.messages{
      flex: 1 1 auto;
      overflow-y: auto;
      margin: 10px 12px;
      padding: 12px;
      border-radius: 12px;
      background: rgba(0,0,0,0.12);
      border: 1px solid rgba(255,255,255,0.06);
      scroll-behavior: smooth;
    }

    #typingIndicator{
      flex: 0 0 auto;
      margin: 0 12px 8px 12px !important;
      opacity: .85;
    }

    /* input stays pinned at bottom inside chat */
    #chat-input{
      flex: 0 0 auto;
      margin: 0;
      padding: 10px 12px 14px 12px;
      display: flex;
      gap: 10px;
      align-items: center;
      background: rgba(0,0,0,0.35);
      border-top: 1px solid rgba(255,255,255,0.06);
    }
    #msgInput{
      flex: 1;
      min-width: 0;
      padding: 12px 14px;
      border-radius: 12px;
    }
    #sendBtn{
      padding: 11px 16px;
      border-radius: 12px;
    }

    /* message animation */
    .msg, .reply-msg{
      animation: msgIn 160ms ease;
      transform-origin: bottom;
    }
    @keyframes msgIn{
      from{ opacity:0; transform: translateY(6px) scale(.995); }
      to{ opacity:1; transform: translateY(0) scale(1); }
    }
  </style>
</head>

<body>
  <div id="root">

    <!-- ADMIN PATH BUTTON -->
    <button class="admin-path-btn"
      onclick="window.location.href='https://donidonka.github.io/SecureText/admin.html'">
      ADMIN PATH
    </button>

    <!-- CLASS SELECT -->
    <div id="screen-class" class="screen active">
      <div class="entry-card">
        <div class="entry-top">
          <div class="brand">
            <div class="brand-badge"><span>ST</span></div>
            <div>
              <h1 class="entry-title">SecureText</h1>
              <p class="entry-sub">Choose your class to get started.</p>
            </div>
          </div>
        </div>

        <div id="classes" class="classes-wrap"></div>
        <p id="classError" class="notice bad"></p>
      </div>
    </div>

    <!-- PIN -->
    <div id="screen-pin" class="screen">
      <div class="entry-card">
        <div class="entry-top">
          <div class="brand">
            <div class="brand-badge"><span>ST</span></div>
            <div>
              <h1 class="entry-title">Enter PIN</h1>
              <p class="entry-sub">Class: <strong id="pinClassName"></strong></p>
            </div>
          </div>
          <button id="pinBackBtn" class="btn ghost">Back</button>
        </div>

        <div class="entry-form">
          <div class="field">
            <div class="label">Class PIN</div>
            <input id="pinInput" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢">
          </div>
          <button id="pinContinueBtn" class="btn primary">Continue</button>
          <p id="pinError" class="notice bad"></p>
        </div>
      </div>
    </div>

    <!-- NAME -->
    <div id="screen-name" class="screen">
      <div class="entry-card">
        <div class="entry-top">
          <div class="brand">
            <div class="brand-badge"><span>ST</span></div>
            <div>
              <h1 class="entry-title">Your Name</h1>
              <p class="entry-sub">This is what others will see in chat.</p>
            </div>
          </div>
          <button id="nameBackBtn" class="btn ghost">Back</button>
        </div>

        <div class="entry-form">
          <div class="field">
            <div class="label">Display name</div>
            <input id="nameInput" class="input" type="text" placeholder="e.g. Tester">
          </div>
          <button id="nameContinueBtn" class="btn primary">Request Access</button>
          <p id="nameError" class="notice bad"></p>
        </div>
      </div>
    </div>

    <!-- WAITING -->
    <div id="screen-wait" class="screen">
      <div class="entry-card">
        <div class="entry-top">
          <div class="brand">
            <div class="brand-badge"><span>ST</span></div>
            <div>
              <h1 class="entry-title">Waiting for Approval</h1>
              <p class="entry-sub" id="waitText"></p>
            </div>
          </div>
          <button id="resetBtn" class="btn ghost">Start over</button>
        </div>

        <div style="position:relative;z-index:1;margin-top:8px;">
          <p class="entry-sub">Keep this tab open â€” youâ€™ll enter chat automatically once approved.</p>
          <p id="waitStatus" class="notice warn"></p>
        </div>
      </div>
    </div>

    <!-- CHAT -->
    <div id="screen-chat" class="screen">
      <div id="chat-screen" class="night">
        <header class="chat-header">
          <div>
            <h1 id="chatWelcome">Welcome!</h1>
            <p class="subtitle" id="chatSubtitle">SecureText chat</p>
          </div>
          <div class="chat-controls">
            <button id="themeToggle">ðŸŒ™</button>
            <button id="logoutBtn">Logout</button>
          </div>
        </header>

        <div id="announcementsBox">
          <strong>Announcements</strong>
          <div id="announcementsList"></div>
        </div>

        <div id="messages" class="messages"></div>

        <div id="typingIndicator"></div>

        <div id="replies-panel" class="replies hidden">
          <div class="replies-header">
            <span id="replies-title">Replies</span>
            <button id="closeReplies">Close</button>
          </div>
          <div id="replies-list" class="replies-list"></div>
          <div class="reply-input">
            <input id="replyMsgInput" type="text" placeholder="Reply...">
            <button id="sendReplyBtn">Send</button>
          </div>
        </div>

        <div id="chat-input">
          <input id="msgInput" type="text" placeholder="Type a message">
          <button id="sendBtn">Send</button>
        </div>

        <p id="chatStatus" class="notice"></p>
      </div>
    </div>

  </div>

  <script src="firebase.js"></script>
  <script src="app.js"></script>
</body>
</html>
